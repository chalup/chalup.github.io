
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Porcupine Programmer</title>
  <meta name="author" content="Jerzy Chalupski">

  
  <meta name="description" content="Few weeks ago I was complaining to another developer that Windows Phone applications cannot perform tasks in background when they are not running. &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://chalup.github.io/blog/page/7">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Porcupine Programmer" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-51611487-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Porcupine Programmer</a></h1>
  
    <h2>Programming rants, random stuff and some more programming.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:chalup.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/04/04/background-operations-on-windows-phone/">Background Operations on Windows Phone 7</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-04-04T13:23:00+02:00" pubdate data-updated="true">Apr 4<span>th</span>, 2012</time>
        
           | <a href="/blog/2012/04/04/background-operations-on-windows-phone/#disqus_thread"
             data-disqus-identifier="http://chalup.github.io/blog/2012/04/04/background-operations-on-windows-phone/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Few weeks ago I was complaining to another developer that Windows Phone applications cannot perform tasks in background when they are not running. That was true few months ago when I learned about Windows Phone 7.0, but he pointed me to MSDN documentation of new WP 7.1 feature: <a href="http://msdn.microsoft.com/en-us/library/hh202961(v=vs.92">Background Agents</a>.aspx).</p>

<p>I clicked the link with my hopes up, but I was immediately shot down with the highlight on the first page: &ldquo;Background agents are not supported on 256-MB devices&rdquo;. I proceeded to the <a href="http://msdn.microsoft.com/en-us/library/hh202942(v=vs.92">overview page</a>.aspx) and it turned out the highlight from the first page was just the tip of the iceberg. The constraints listed there are just staggering.</p>

<p>First there are the registration issues: you can register background task for the next two weeks and after that period your application have to reschedule the task. I&rsquo;m not sure why do I have to do this, and at the first glance it looks only like a minor nuisance, until you take into account two other constraints: tasks cannot reschedule themselves and there is a hard limit of scheduled periodic tasks, which can be ridiculously low. Relevant quote from MSDN:</p>

<blockquote><p>To help maximize the battery life of the device, there is a hard limit on the number of periodic agents that can be scheduled on the phone. It varies per device configuration and can be as low as 6.</p></blockquote>


<p>Not a minor nuisance anymore, huh?</p>

<p>This limit is only imposed on periodic agents, which are intended for short, periodic tasks like polling some service or uploading a data. There are also Resource Intensive Agents which can be used for longer tasks like data synchronization, but they have their own set of constraints: the device have to be charging, the battery have to be almost fully charged and there should be a Wi-Fi or PC connection (no cellular data). I think the MSDN note summarizes it quite well:</p>

<blockquote><p>Due to the constraints on the device that must be met for resource-intensive agents to run, it is possible that the agent will never be run on a particular device. </p><p>(&#8230;)Also, resource-intensive agents are run one at a time, so as more applications that use resource-intensive agents are installed on a device, the likelihood of an agent running becomes even less. You should consider this when designing your application.</p></blockquote>


<p>I&rsquo;m going to add to the comment above my own observation: every application can register only one background agent, which can be both periodic agent and resource intensive agent. It means that if you need both types of agents, your resource intensive agent is also affected by the periodic agent hard limit.</p>

<p>It all boils down to this: <strong>you can&rsquo;t rely on the background agents</strong>. You don&rsquo;t have the guarantee that you&rsquo;ll be able to register the agent, which means that you can&rsquo;t use them for critical functionality. So we&rsquo;re exactly where we were after 7.0 release.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/03/28/qml-error-handling-revisited/">QML Error Handling Revisited</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-03-28T23:01:00+02:00" pubdate data-updated="true">Mar 28<span>th</span>, 2012</time>
        
           | <a href="/blog/2012/03/28/qml-error-handling-revisited/#disqus_thread"
             data-disqus-identifier="http://chalup.github.io/blog/2012/03/28/qml-error-handling-revisited/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>After releasing <a href="http://store.ovi.com/content/219800">Nu, Pogodi!</a> I learned the hard way that checking the QML runtime errors might be a good idea. For that particular application, simply checking the errors from <code>QDeclarativeView</code> after setting the main qml file was enough, because everything in qml file was statically declared. But what if you use <a href="https://qt-project.org/doc/qt-4.8/qml-loader.html">QML Loader</a> element, either explicitly or through some other qml element like <a href="http://doc.qt.nokia.com/qt-components-symbian/qml-pagestack.html">PageStack from Qt Components</a>, and something goes wrong?</p>

<p>Well, if you don&rsquo;t improve the error handling code, your application will silently fail in some places, which probably won&rsquo;t make the users happy. I didn&rsquo;t wanted to repeat the <a href="http://store.ovi.com/content/219800">Nu, Pogodi!</a> screw up when releasing <a href="http://store.ovi.com/content/262535">Word Judge</a>, so I&rsquo;ve created a better error handling solution. First part is an error handler class:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
</pre></td><td class='code'><pre><code class='cpp'><span class='line'><span class="c1">// ----------------------------------------</span>
</span><span class='line'><span class="c1">//  qmlerrorhandler.h</span>
</span><span class='line'><span class="c1">// ----------------------------------------</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">QmlErrorHandler</span> <span class="o">:</span> <span class="k">public</span> <span class="n">QObject</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="n">Q_OBJECT</span>
</span><span class='line'><span class="k">public</span><span class="o">:</span>
</span><span class='line'>    <span class="k">explicit</span> <span class="n">QmlErrorHandler</span><span class="p">(</span><span class="n">QDeclarativeView</span> <span class="o">&amp;</span><span class="n">view</span><span class="p">,</span> <span class="n">QObject</span> <span class="o">*</span><span class="n">parent</span> <span class="o">=</span> <span class="mi">0</span><span class="p">);</span>
</span><span class='line'>    <span class="kt">bool</span> <span class="n">errorOccured</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">private</span> <span class="nl">slots:</span>
</span><span class='line'>    <span class="kt">void</span> <span class="n">handleQmlStatusChange</span><span class="p">(</span><span class="n">QDeclarativeView</span><span class="o">::</span><span class="n">Status</span> <span class="n">status</span><span class="p">);</span>
</span><span class='line'>    <span class="kt">void</span> <span class="n">handleQmlErrors</span><span class="p">(</span><span class="k">const</span> <span class="n">QList</span><span class="o">&lt;</span><span class="n">QDeclarativeError</span><span class="o">&gt;&amp;</span> <span class="n">qmlErrors</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="k">private</span><span class="o">:</span>
</span><span class='line'>    <span class="n">QDeclarativeView</span> <span class="o">&amp;</span><span class="n">mView</span><span class="p">;</span>
</span><span class='line'>    <span class="kt">bool</span> <span class="n">mErrorOccured</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="p">};</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// ----------------------------------------</span>
</span><span class='line'><span class="c1">//  qmlerrorhandler.cpp</span>
</span><span class='line'><span class="c1">// ----------------------------------------</span>
</span><span class='line'>
</span><span class='line'><span class="n">QmlErrorHandler</span><span class="o">::</span><span class="n">QmlErrorHandler</span><span class="p">(</span><span class="n">QDeclarativeView</span> <span class="o">&amp;</span><span class="n">view</span><span class="p">,</span> <span class="n">QObject</span> <span class="o">*</span><span class="n">parent</span><span class="p">)</span> <span class="o">:</span>
</span><span class='line'>    <span class="n">QObject</span><span class="p">(</span><span class="n">parent</span><span class="p">),</span>
</span><span class='line'>    <span class="n">mView</span><span class="p">(</span><span class="n">view</span><span class="p">),</span>
</span><span class='line'>    <span class="n">mErrorOccured</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="n">connect</span><span class="p">(</span><span class="o">&amp;</span><span class="n">view</span><span class="p">,</span> <span class="n">SIGNAL</span><span class="p">(</span><span class="n">statusChanged</span><span class="p">(</span><span class="n">QDeclarativeView</span><span class="o">::</span><span class="n">Status</span><span class="p">)),</span> <span class="n">SLOT</span><span class="p">(</span><span class="n">handleQmlStatusChange</span><span class="p">(</span><span class="n">QDeclarativeView</span><span class="o">::</span><span class="n">Status</span><span class="p">)));</span>
</span><span class='line'>    <span class="n">connect</span><span class="p">(</span><span class="n">view</span><span class="p">.</span><span class="n">engine</span><span class="p">(),</span> <span class="n">SIGNAL</span><span class="p">(</span><span class="n">warnings</span><span class="p">(</span><span class="n">QList</span><span class="o">&lt;</span><span class="n">QDeclarativeError</span><span class="o">&gt;</span><span class="p">)),</span> <span class="n">SLOT</span><span class="p">(</span><span class="n">handleQmlErrors</span><span class="p">(</span><span class="n">QList</span><span class="o">&lt;</span><span class="n">QDeclarativeError</span><span class="o">&gt;</span><span class="p">)));</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">QmlErrorHandler</span><span class="o">::</span><span class="n">handleQmlStatusChange</span><span class="p">(</span><span class="n">QDeclarativeView</span><span class="o">::</span><span class="n">Status</span> <span class="n">status</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">status</span> <span class="o">==</span> <span class="n">QDeclarativeView</span><span class="o">::</span><span class="n">Error</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">handleQmlErrors</span><span class="p">(</span><span class="n">mView</span><span class="p">.</span><span class="n">errors</span><span class="p">());</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">QmlErrorHandler</span><span class="o">::</span><span class="n">handleQmlErrors</span><span class="p">(</span><span class="k">const</span> <span class="n">QList</span><span class="o">&lt;</span><span class="n">QDeclarativeError</span><span class="o">&gt;&amp;</span> <span class="n">qmlErrors</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="n">QStringList</span> <span class="n">errors</span><span class="p">;</span>
</span><span class='line'>    <span class="n">foreach</span> <span class="p">(</span><span class="k">const</span> <span class="n">QDeclarativeError</span><span class="o">&amp;</span> <span class="n">error</span><span class="p">,</span> <span class="n">qmlErrors</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="c1">// Special case for bug in QtComponents 1.1</span>
</span><span class='line'>        <span class="c1">// https://bugreports.qt-project.org/browse/QTCOMPONENTS-1217</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="n">error</span><span class="p">.</span><span class="n">url</span><span class="p">().</span><span class="n">toString</span><span class="p">().</span><span class="n">endsWith</span><span class="p">(</span><span class="s">&quot;PageStackWindow.qml&quot;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">error</span><span class="p">.</span><span class="n">line</span><span class="p">()</span> <span class="o">==</span> <span class="mi">70</span><span class="p">)</span>
</span><span class='line'>            <span class="k">continue</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">errors</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">error</span><span class="p">.</span><span class="n">toString</span><span class="p">());</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">errors</span><span class="p">.</span><span class="n">isEmpty</span><span class="p">())</span>
</span><span class='line'>        <span class="k">return</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">mErrorOccured</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">QMessageBox</span> <span class="n">msgBox</span><span class="p">;</span>
</span><span class='line'>    <span class="n">msgBox</span><span class="p">.</span><span class="n">setText</span><span class="p">(</span><span class="s">&quot;Uh oh, something went terribly wrong!&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="n">msgBox</span><span class="p">.</span><span class="n">setInformativeText</span><span class="p">(</span><span class="s">&quot;We&#39;re sorry, but it seems there are some problems &quot;</span>
</span><span class='line'>                              <span class="s">&quot;with running our application on your phone. Please &quot;</span>
</span><span class='line'>                              <span class="s">&quot;send us the following information to help us resolve &quot;</span>
</span><span class='line'>                              <span class="s">&quot;this issue:</span><span class="se">\n\n</span><span class="s">&quot;</span><span class="p">)</span> <span class="o">+</span>
</span><span class='line'>                              <span class="n">errors</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">));</span>
</span><span class='line'>    <span class="n">msgBox</span><span class="p">.</span><span class="n">exec</span><span class="p">();</span>
</span><span class='line'>    <span class="n">qApp</span><span class="o">-&gt;</span><span class="n">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">bool</span> <span class="n">QmlErrorHandler</span><span class="o">::</span><span class="n">errorOccured</span><span class="p">()</span> <span class="k">const</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">mErrorOccured</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>And here&rsquo;s how I use it in my applications:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='cpp'><span class='line'><span class="kt">int</span> <span class="n">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="n">QScopedPointer</span><span class="o">&lt;</span><span class="n">QApplication</span><span class="o">&gt;</span> <span class="n">app</span><span class="p">(</span><span class="n">createApplication</span><span class="p">(</span><span class="n">argc</span><span class="p">,</span> <span class="n">argv</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">QScopedPointer</span><span class="o">&lt;</span><span class="n">QmlApplicationViewer</span><span class="o">&gt;</span> <span class="n">viewer</span><span class="p">(</span><span class="n">QmlApplicationViewer</span><span class="o">::</span><span class="n">create</span><span class="p">());</span>
</span><span class='line'>    <span class="n">QmlErrorHandler</span> <span class="n">errorHandler</span><span class="p">(</span><span class="o">*</span><span class="n">viewer</span><span class="p">);</span>
</span><span class='line'>    <span class="n">viewer</span><span class="o">-&gt;</span><span class="n">setMainQmlFile</span><span class="p">(</span><span class="n">QLatin1String</span><span class="p">(</span><span class="s">&quot;main.qml&quot;</span><span class="p">));</span>
</span><span class='line'>    <span class="n">viewer</span><span class="o">-&gt;</span><span class="n">showExpanded</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">errorHandler</span><span class="p">.</span><span class="n">errorOccured</span><span class="p">())</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">app</span><span class="o">-&gt;</span><span class="n">exec</span><span class="p">();</span>
</span><span class='line'>    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Basically we need to catch the runtime errors, which are emitted from <code>QDeclarativeEngine</code> in signal named for some unfathomable reason <code>warnings</code>. Checking the <code>errorOccured()</code> in <code>main()</code> is ugly, but the <code>qApp-&gt;exit()</code> doesn&rsquo;t work until the event loop in main is started and that&rsquo;s the first thing which came to my mind. Please leave a comment if you know a simpler solution.</p>

<p>Note the lines 46-49 in <code>QmlErrorHandler</code>: we&rsquo;re catching all warnings and the qt components are not completely free of them. I had to add a special case to prevent triggering the handler on every orientation change. If you stumble upon some other errors that should be ignored, please let me know.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/03/23/word-judge-for-symbian-available-in/">Word Judge for Symbian Available in Nokia Store</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-03-23T23:23:00+01:00" pubdate data-updated="true">Mar 23<span>rd</span>, 2012</time>
        
           | <a href="/blog/2012/03/23/word-judge-for-symbian-available-in/#disqus_thread"
             data-disqus-identifier="http://chalup.github.io/blog/2012/03/23/word-judge-for-symbian-available-in/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Today I have finally pushed both versions of Word Judge through Nokia Store QA. The version with an english dictionary was available for over the week now, but I had to submit the polish version few times until it passed the Nokia tests.</p>

<p>Anyways, the applications are available for free in Nokia Store. Here&rsquo;s the link for <a href="http://store.ovi.com/content/262526">english version</a> and <a href="http://store.ovi.com/content/262535">polish version</a> (might not be available in all countries &ndash; I had to add some restrictions to pass QA process).</p>

<p>Stay tuned for posts about development of Symbian version and enjoy your Scrabble games.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/03/19/dawg-data-structure-in-word-judge/">DAWG Data Structure in Word Judge</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-03-19T14:01:00+01:00" pubdate data-updated="true">Mar 19<span>th</span>, 2012</time>
        
           | <a href="/blog/2012/03/19/dawg-data-structure-in-word-judge/#disqus_thread"
             data-disqus-identifier="http://chalup.github.io/blog/2012/03/19/dawg-data-structure-in-word-judge/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I&rsquo;m the first to admit that the Word Judge is booooring application. Checking if the word can be used in a word game? Meh. From a programmer perspective however, there is one very interesting problem to solve &ndash; how to compress a large dictionary to reduce the size of the application package and at the same time be able to query this dictionary without using excessive amount of memory and CPU power?</p>

<p>First, let&rsquo;s settle on what is a &ldquo;large dictionary&rdquo;. One of the languages supported by Word Judge is Polish, for which the valid word list has over 2 million entries and takes about 36MB after unpacking. Do we need to compress this data at all? Probably not. If you consider the average hardware spec and modern network speed, the 36MB is not much, but we can do so much better. Besides, it&rsquo;s fun!</p>

<p>One the other end of the spectrum is the &ldquo;zip all the things&rdquo; approach. It&rsquo;s not a good idea though &ndash; it puts a very heavy load on the CPU and doesn&rsquo;t compress the data that well. The zipped Polish dictionary takes 4.5MB.</p>

<p>The most important observation is that we&rsquo;re not compressing some random white noise, but words from real language. We can leverage this information to get a much better compression than some generic algorithm. Lot of words share the same prefix and suffix, which means they can be efficiently represented as a directed acyclic graph with shared nodes for common prefixes and suffixes. Let&rsquo;s see how the graph would look like for couple of words:</p>

<p><img class="center" src="/images/dag.png"></p>

<p>White letters on black background mark the nodes representing the ends of words. So the graph above represents the following words:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>abject
</span><span class='line'>abjection
</span><span class='line'>abjections
</span><span class='line'>abjectly
</span><span class='line'>abjectness
</span><span class='line'>ablate
</span><span class='line'>ablated
</span><span class='line'>ablation
</span><span class='line'>ablations</span></code></pre></td></tr></table></div></figure>


<p>The nodes for <code>ab</code> prefix are of course shared, the <code>ions</code>, <code>s</code> suffixes nodes as well. For obvious reasons we cannot share the <code>t</code> node: in one group it marks the end of the word, in other it does not; the child nodes for each &rsquo;t&#8217; nodes are also different. Nodes are equal, and thus can be shared, if and only if they represent the same letter, the End Of Word flag is the same for both of them, and the list of children is exactly the same.</p>

<p>This type of graph contains minimal number of nodes, but each node takes quite a lot of space. We need 8 bits for the letter, 1 bit for EOW flag, 8 bits for the children list length and some kind of reference, for example node index, to each child, which is log2(n) rounded up bits, where n is a number of nodes in the graph. As you can see the major contributor to a single node size is the children list: for TWL06 dictionary the number of nodes is in the 10k-100k order of magnitude, which means we need several bits per node index.</p>

<p>A guy called John Paul Adamovsky <a href="http://www.pathcom.com/~vadco/dawg.html">found a neat solution to that</a>. Instead of keeping the full list of children, we can keep children in something similar to singly-linked list: let&rsquo;s store only the index of the first child, number the nodes in such way that the children always have consecutive indices and add a End Of Children List flag to each node. This way we need exactly 1 + log2(n) bits for child list. This way we can keep the entire node in one byte. What&rsquo;s the catch? We need to introduce few more nodes.</p>

<p>For example on the graph above we can no longer share the <code>i</code> node in the <code>ions</code> suffix: if it was shared it would have to have a number one greater than the number of both <code>e</code> node in <code>ablate</code> and <code>n</code> node in <code>abjectness</code> (this is, of course, assuming the <code>i</code> node is the last on the child list of both <code>t</code> nodes; but it&rsquo;s impossible for any node ordering). Our graph would look like this:</p>

<p><img class="center" src="/images/dawg.png"></p>

<p>The rule for node equality has to be extended: the nodes are equal if they represent the same letter, the flags are the same, the children are equal and the siblings further on the children list are equal. The last condition is a bit confusing, so I&rsquo;ll provide an example.</p>

<p>Let&rsquo;s add a <code>absolution</code> and <code>absolutions</code> to our dictionary. We can certainly share the <code>ab</code> prefix and <code>ons</code> suffix, but do we need a separate <code>i</code> node as well? The <code>i</code> node in <code>absolution</code> must have a End-Of-Child-List flag set. If we arrange the child nodes in either <code>ablat-</code> or <code>abject-</code> part of graph in such way that the <code>i</code> node is the last node, we can share the <code>i</code> node between that part of graph and the newly added branch. Our graph would look like this:</p>

<p><img class="center" src="/images/dawg2.png"></p>

<p>This is the way we can squeeze the 36MB dictionary to 1.5MB. The structure also doesn&rsquo;t need any processing, it can be loaded to int array and used directly. If you&rsquo;re curious how to convert the dictionary into this kind of graph you can read the description of <a href="https://github.com/chalup/dawggenerator">my dawggenerator project on github</a> (C++) or the <a href="http://www.pathcom.com/~vadco/dawg.html">original description by John Paul Adamovsky</a> (pure C).</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/03/14/large-raw-assets-in-android-22/">Large Raw Assets in Android 2.2</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-03-14T07:50:00+01:00" pubdate data-updated="true">Mar 14<span>th</span>, 2012</time>
        
           | <a href="/blog/2012/03/14/large-raw-assets-in-android-22/#disqus_thread"
             data-disqus-identifier="http://chalup.github.io/blog/2012/03/14/large-raw-assets-in-android-22/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>My most recent application, <a href="https://play.google.com/store/apps/details?id=com.chalup.WordJudgeEN">Word Judge</a>, contains full dictionary of word valid in word games. I went to great lengths to minimize the size of this data, but for some languages it&rsquo;s still quite large. For example polish dictionary is compressed from 35MB to 1.4MB. In Android 2.2 and earlier, if you add such large file as an asset and then try to open it, you&rsquo;ll get <code>IOException</code>. The exception itself doesn&rsquo;t contain any useful information, but the following text appears in logcat:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>03-07 14:40:42.345: D/asset(301): Data exceeds UNCOMPRESS_DATA_MAX (1442144 vs 1048576)</span></code></pre></td></tr></table></div></figure>


<p>With that information <a href="http://www.google.pl/search?sourceid=chrome&amp;ie=UTF-8&amp;q=UNCOMPRESS_DATA_MAX+site%3Astackoverflow.com">googling the workaround is easy</a>. Some folks recommend splitting the file into multiple parts, or repackaging the apk, but the simplest solution is to change the file extension of your asset to one of the extensions listed in aapt tool sources as files that are not compressed by default:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="cm">/* these formats are already compressed, or don&#39;t compress well */</span>
</span><span class='line'><span class="kd">static</span> <span class="kd">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">kNoCompressExt</span><span class="o">[]</span> <span class="o">=</span> <span class="o">{</span>
</span><span class='line'>    <span class="s">&quot;.jpg&quot;</span><span class="o">,</span> <span class="s">&quot;.jpeg&quot;</span><span class="o">,</span> <span class="s">&quot;.png&quot;</span><span class="o">,</span> <span class="s">&quot;.gif&quot;</span><span class="o">,</span>
</span><span class='line'>    <span class="s">&quot;.wav&quot;</span><span class="o">,</span> <span class="s">&quot;.mp2&quot;</span><span class="o">,</span> <span class="s">&quot;.mp3&quot;</span><span class="o">,</span> <span class="s">&quot;.ogg&quot;</span><span class="o">,</span> <span class="s">&quot;.aac&quot;</span><span class="o">,</span>
</span><span class='line'>    <span class="s">&quot;.mpg&quot;</span><span class="o">,</span> <span class="s">&quot;.mpeg&quot;</span><span class="o">,</span> <span class="s">&quot;.mid&quot;</span><span class="o">,</span> <span class="s">&quot;.midi&quot;</span><span class="o">,</span> <span class="s">&quot;.smf&quot;</span><span class="o">,</span> <span class="s">&quot;.jet&quot;</span><span class="o">,</span>
</span><span class='line'>    <span class="s">&quot;.rtttl&quot;</span><span class="o">,</span> <span class="s">&quot;.imy&quot;</span><span class="o">,</span> <span class="s">&quot;.xmf&quot;</span><span class="o">,</span> <span class="s">&quot;.mp4&quot;</span><span class="o">,</span> <span class="s">&quot;.m4a&quot;</span><span class="o">,</span>
</span><span class='line'>    <span class="s">&quot;.m4v&quot;</span><span class="o">,</span> <span class="s">&quot;.3gp&quot;</span><span class="o">,</span> <span class="s">&quot;.3gpp&quot;</span><span class="o">,</span> <span class="s">&quot;.3g2&quot;</span><span class="o">,</span> <span class="s">&quot;.3gpp2&quot;</span><span class="o">,</span>
</span><span class='line'>    <span class="s">&quot;.amr&quot;</span><span class="o">,</span> <span class="s">&quot;.awb&quot;</span><span class="o">,</span> <span class="s">&quot;.wma&quot;</span><span class="o">,</span> <span class="s">&quot;.wmv&quot;</span>
</span><span class='line'><span class="o">};</span>
</span></code></pre></td></tr></table></div></figure>


<p>Of course if you target API level 9 or newer, you don&rsquo;t have to worry about this gotcha.</p>

<p>There is one more thing worth mentioning: the speed of IO operations in debug mode is atrocious. Loading the 1.4MB dictionary to memory takes over 10 seconds. Fortunately when the program is running without debugger attached, the loading time decreases to less than 1 second.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/03/10/introducing-word-judge/">Introducing: Word Judge</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-03-10T11:17:00+01:00" pubdate data-updated="true">Mar 10<span>th</span>, 2012</time>
        
           | <a href="/blog/2012/03/10/introducing-word-judge/#disqus_thread"
             data-disqus-identifier="http://chalup.github.io/blog/2012/03/10/introducing-word-judge/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I enjoy playing Scrabble and other word games like WordSquared of Word with Friends and I think I&rsquo;m quite good at them for an amateur &ndash; my average score in 2-player Scrabble game is around 330 points. I do not have a tournament aspirations, because memorizing word lists or best stems doesn&rsquo;t fit my definition of fun, but I&rsquo;m always in for a casual game.</p>

<p>The only thing that bothers me during these casual games are occasional, but unpleasant arguments &ndash; how do you spell given word or what is some 3 letter combination an obscure word or gibberish. Polish language have both <a href="http://en.wikipedia.org/wiki/Declension">declension</a> and <a href="http://en.wikipedia.org/wiki/Conjugation">conjugation</a> with a lot of irregularities, so there are plenty of things to argue about.</p>

<p>Most of the times we sort things out simply by checking the word spelling on the Internet, but there are situations when you can&rsquo;t do that, for example when you&rsquo;re abroad and don&rsquo;t have wi-fi access and roaming data access price is extraorbitant, or you&rsquo;re in the middle of the outback with no connectivity whatsoever. Without that possibility you have to find a compromise, and boy, that&rsquo;s not easy when you challenge someones 7-letter word on two triple-word bonus tiles.</p>

<p>That&rsquo;s why I created Word Judge &ndash; an ultimate way to settle all word-related disputes. The application contains full dictionary of valid words and short word list with definitions. Dictionary is shipped with the application, so you don&rsquo;t need internet connectivity to check if the word can be used in a word game. Currently the application is available only for Android devices, but I&rsquo;m going to release Symbian (and maybe Harmattan?) version soon.</p>

<table class="separator" style="clear: both; text-align: center;"><tbody><tr><td><img class="center" src="/images/screenshot1.png"></td><td><img class="center" src="/images/screenshot2.png"></td><td><img class="center" src="/images/screenshot3.png"></td></tr></tbody></table>


<p>Unlike many other word game helpers, Word Judge doesn&rsquo;t contain anagrammer tool. It&rsquo;s not an oversight, it didn&rsquo;t add it for two reasons. First of all I don&rsquo;t think that such functionality should be bundled with the application, which is basically a dictionary. You use a dictionary to check the spelling, not to cheat. The second reason is more prosaic &ndash; I don&rsquo;t like the UI of any anagrammer tools I found. It&rsquo;s usually a jumble of checkboxes and radio buttons and two fields for board and rack tiles. Even if you figure out what all those controls do, these tools don&rsquo;t really solve the problem, which is finding the best move. It&rsquo;s not an easy problem, even if you find a convenient way to import current game state to the application (<a href="http://en.wikipedia.org/wiki/Augmented_reality">AR</a> maybe?). It&rsquo;s certainly a good idea for a separate application, but not for a part of a dictionary app.</p>

<p>I released one version of my application for every supported language (currently only <a href="https://play.google.com/store/apps/details?id=com.chalup.WordJudgeEN">English</a> and <a href="https://play.google.com/store/apps/details?id=com.chalup.WordJudgePL">Polish</a>). I considered setting up a service with downloadable dictionaries, but I decided against it, because it would needlessly complicate the application and I think that using multiple dictionaries is quite rare use case. Let me know if I&rsquo;m wrong, I might change my mind. Also, if you like the idea of my application and want me to create a Word Judge for your language, <a href="mailto:jerzy.chalupski@gmail.com">send me an email</a>. Unfortunately, since the app is free I cannot offer you anything more than a mention in application description and &ldquo;About&rdquo; window.</p>

<p>I was sure from the start that I won&rsquo;t charge money for this app, but I pondered for quite a long time if I should use ads. On one hand they are visually displeasing and take scarce screen real estate. On the other hand, I want to see for myself how much revenue they generate &ndash; the testimonies of other developers vary from ecstatic to disappointed. In the end I decided to add a small banner as an experiment.</p>

<p>This post is already getting too long, so let me just mention that in the next week or so I&rsquo;m going to write about stuff I learned while working on this application. I hope you&rsquo;ll enjoy the reading. Meanwhile, dust of your Scrabble board, <a href="https://play.google.com/store/apps/details?id=com.chalup.WordJudgeEN">download my app</a> and enjoy an argument-free game!</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/03/08/customizing-ui-controls-on-android/">Customizing UI Controls on Android</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-03-08T15:09:00+01:00" pubdate data-updated="true">Mar 8<span>th</span>, 2012</time>
        
           | <a href="/blog/2012/03/08/customizing-ui-controls-on-android/#disqus_thread"
             data-disqus-identifier="http://chalup.github.io/blog/2012/03/08/customizing-ui-controls-on-android/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>By customizing I mean &ldquo;Oh, and can we have buttons with pink background and neon green text&rdquo; requests you get from your customers. It turns out that such simple requests are in fact not simple. Take a look at the following screenshots taken on HTC Desire phone:</p>

<p><img class="center" src="/images/customizingUIcontrols.png"></p>

<p>The &ldquo;Nexus&rdquo; button uses custom background selector copied from Android sources, so it looks exactly like a buttons on Nexus phones. The &ldquo;HTC&rdquo; button is using default background selector for HTC phones. As you can see there are few differences: highlight, corner rounding and slightly different padding. Other vendors also customize default look of UI controls: Motorola uses red highlight, and Samsung tablets use light blue highlight and there are probably some minor differences in padding and rounding as well.</p>

<p>Let&rsquo;s get back to the original problem, i.e. using pink background and neon green text. Obviously we cannot change just the text color, because it would be unreadable on HTC devices. Changing the background is also tricky, because you cannot reuse highlight graphics built into the platform resources: the different padding and corner rounding force you to use custom graphics for every state. Using layer list drawable to add some decoration is also out of the question, because of the differences in padding &ndash; most likely your decoration would be off by few pixels on some devices.</p>

<p>But now you have one completely custom UI control, which stands apart of built in controls. So for me it&rsquo;s rather &ldquo;all or nothing&rdquo; approach &ndash; either you customize all your UI controls (which might be very time consuming) or you use default controls.</p>

<p>I found one exception to this unfortunate situation: it&rsquo;s possible to create a ListView items with custom &ldquo;normal&rdquo; background and default highlight. Just use the following selector for list item background:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span>
</span><span class='line'><span class="nt">&lt;selector</span> <span class="na">xmlns:android=</span><span class="s">&quot;http://schemas.android.com/apk/res/android&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;item</span> <span class="na">android:state_selected=</span><span class="s">&quot;true&quot;</span> <span class="na">android:drawable=</span><span class="s">&quot;@android:color/transparent&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>    <span class="nt">&lt;item</span> <span class="na">android:state_focused=</span><span class="s">&quot;true&quot;</span> <span class="na">android:drawable=</span><span class="s">&quot;@android:color/transparent&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>    <span class="nt">&lt;item</span> <span class="na">android:state_pressed=</span><span class="s">&quot;true&quot;</span> <span class="na">android:drawable=</span><span class="s">&quot;@android:color/transparent&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>    <span class="nt">&lt;item</span> <span class="na">android:drawable=</span><span class="s">&quot;@drawable/list_item&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'><span class="nt">&lt;/selector&gt;</span>
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/03/02/dip-on-blackberry/">DIP on BlackBerry</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-03-02T21:35:00+01:00" pubdate data-updated="true">Mar 2<span>nd</span>, 2012</time>
        
           | <a href="/blog/2012/03/02/dip-on-blackberry/#disqus_thread"
             data-disqus-identifier="http://chalup.github.io/blog/2012/03/02/dip-on-blackberry/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Android has this nice notion of <a href="http://developer.android.com/guide/practices/screens_support.html#density-independence">density-independent pixel</a> &ndash; a measurement unit which ensures the widgets have the same physical size on the devices with different screen size and different resolution. Basically 1dp is 1px on a device with 160dpi and is scaled appropriately on devices with different dpi.</p>

<p>Why is it important? Because if you design your UI in px on high resolution device and then run it on low resolution device, you&rsquo;ll end up with gigantic buttons which take 50% of the screen. If you do the opposite, you&rsquo;ll end up with button, which are too small to click on high res device.</p>

<p><a href="http://developer.android.com/images/screens_support/density-test-bad.png"><img class="center" src="http://developer.android.com/images/screens_support/density-test-bad.png"></a></p>

<p>Unfortunately the BlackBerry doesn&rsquo;t support this concept out of the box. By default you specify the size and position of UI controls in regular pixels. The <a href="http://docs.blackberry.com/en/developers/deliverables/29251/Developing_apps_for_different_screen_sizes_1579421_11.jsp">BlackBerry documentation</a> suggests using this nugget of a code:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kt">boolean</span> <span class="n">lowRes</span> <span class="o">=</span> <span class="n">Display</span><span class="o">.</span><span class="na">getWidth</span><span class="o">()</span> <span class="o">&lt;=</span> <span class="mi">320</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">if</span> <span class="o">(</span><span class="n">lowRes</span><span class="o">)</span>
</span><span class='line'><span class="o">{</span>
</span><span class='line'>    <span class="c1">// The device has a low resolution screen size</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'><span class="k">else</span>
</span><span class='line'><span class="o">{</span>
</span><span class='line'>    <span class="c1">// The device has a high resolution screen size</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>But I think there is a better way.</p>

<p>The net.rim.device.api.ui.Ui contains the static method convertSize that can be used, as you might have guessed, for size conversion between different measurement units. We&rsquo;ll of course convert our measurements to pixels, because that&rsquo;s the unit expected by most drawing methods. But what unit will we convert from?</p>

<p>Points are nice, because you probably use them for your font size already, but they are to coarse to be used for all components. Fortunately there is no need to write a wrapper for your own unit, because you can use built-in unit called centipoints. 100 centipoints = 1 point, so this unit should provide enough precision to layout elements just the way you want.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/02/28/wp7-webrequest-oddity/">WP7 WebRequest Oddity</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-02-28T09:50:00+01:00" pubdate data-updated="true">Feb 28<span>th</span>, 2012</time>
        
           | <a href="/blog/2012/02/28/wp7-webrequest-oddity/#disqus_thread"
             data-disqus-identifier="http://chalup.github.io/blog/2012/02/28/wp7-webrequest-oddity/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>During testing of a Windows Phone 7 application I write during my day job I noticed strange thing: when I disabled network connection, I received 404 NotFound error. More precisely, the WebRequest threw WebException with Status = UnknownError, Response.Uri = {} and Response.StatusCode = NotFound.</p>

<p><img class="center" src="/images/no+connection.jpg"></p>

<p>So you get 404 in two cases: when either connection endpoint is down or when server actually responds with 404 NotFound. It would be nice to separate those two cases though, for example to display to the user the message that actually helps them fix the problem.</p>

<p><img class="center" src="/images/wrong+url.jpg"></p>

<p>Fortunately you can tell those two situations apart by checking WebException.Response.ResponseUri &ndash; in case of connection failure it contains empty Uri object (not null, just empty). Here&rsquo;s the extension method I use to convert the exception to the one that makes more sense to me:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='c#'><span class='line'><span class="k">public</span> <span class="k">static</span> <span class="n">WebResponse</span> <span class="nf">SaneEndGetResponse</span><span class="p">(</span><span class="k">this</span> <span class="n">WebRequest</span> <span class="n">request</span><span class="p">,</span> <span class="n">IAsyncResult</span> <span class="n">asyncResult</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">try</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">request</span><span class="p">.</span><span class="n">EndGetResponse</span><span class="p">(</span><span class="n">asyncResult</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">catch</span> <span class="p">(</span><span class="n">WebException</span> <span class="n">wex</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="n">wex</span><span class="p">.</span><span class="n">Response</span> <span class="p">!=</span> <span class="k">null</span> <span class="p">&amp;&amp;</span>
</span><span class='line'>            <span class="p">((</span><span class="n">HttpWebResponse</span><span class="p">)</span><span class="n">wex</span><span class="p">.</span><span class="n">Response</span><span class="p">).</span><span class="n">StatusCode</span> <span class="p">==</span> <span class="n">HttpStatusCode</span><span class="p">.</span><span class="n">NotFound</span> <span class="p">&amp;&amp;</span>
</span><span class='line'>            <span class="n">wex</span><span class="p">.</span><span class="n">Response</span><span class="p">.</span><span class="n">ResponseUri</span> <span class="p">!=</span> <span class="k">null</span> <span class="p">&amp;&amp;</span>
</span><span class='line'>            <span class="n">String</span><span class="p">.</span><span class="n">IsNullOrEmpty</span><span class="p">(</span><span class="n">wex</span><span class="p">.</span><span class="n">Response</span><span class="p">.</span><span class="n">ResponseUri</span><span class="p">.</span><span class="n">ToString</span><span class="p">()))</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="k">throw</span> <span class="k">new</span> <span class="nf">WebException</span><span class="p">(</span><span class="s">&quot;Network error&quot;</span><span class="p">,</span> <span class="n">WebExceptionStatus</span><span class="p">.</span><span class="n">ConnectFailure</span><span class="p">);</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="k">throw</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/02/24/nu-pogodi-bought-by-over-2000-users/">&#8220;Nu, Pogodi!&#8221; Bought by Over 2000 Users</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-02-24T22:53:00+01:00" pubdate data-updated="true">Feb 24<span>th</span>, 2012</time>
        
           | <a href="/blog/2012/02/24/nu-pogodi-bought-by-over-2000-users/#disqus_thread"
             data-disqus-identifier="http://chalup.github.io/blog/2012/02/24/nu-pogodi-bought-by-over-2000-users/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>This week my <a href="http://store.ovi.com/content/219800">&ldquo;Nu, Pogodi!&rdquo;</a> game reached the 2000 downloads from Nokia Store. It might not be a lot if you compare it to the number of Angry Birds downloads, but considering that a) the game is paid, i.e. those 2000 Nokia phone users actually spent their money on my game, and b) it took about two weeks total to program it, I think it&rsquo;s a very good result.</p>

<p>Despite the fact that the game is very simple, <a href="/blog/2012/01/22/how-not-to-test-your-qml-application">I&rsquo;ve learned</a> <a href="/blog/2012/01/31/updating-qt-applications-in-nokia-store/">a lot</a> <a href="/blog/2012/02/01/handling-qml-errors-101">while writing</a> <a href="/blog/2012/02/23/nokia-belle-update-and-content">and publishing it</a>, which makes me very excited about the next, more complex programs I&rsquo;m going to release and gives me enormous motivation boost. Now I just need to get to keep working before it wears off.</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/8/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/blog/page/6/">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2014/06/13/beatiful-code-comparisonchain-from-guava/">Beatiful Code: ComparisonChain</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/06/12/android-loaders/">Android Loaders</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/06/10/enabling-proguard-for-debug-builds/">ProGuard in Ant Debug Builds</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/05/22/clicking-unclickable-list-items/">Clicking Unclickable List Items</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/05/10/android-app-widgets-issues/">Android App Widgets Issues</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/chalup">@chalup</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'chalup',
            count: 0,
            skip_forks: true,
            filter_repos: [ "microorm", "thneed", "dawggenerator", "cerberus" ],
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>



<section class="googleplus">
  <h1>
    <a href="https://plus.google.com/106340839330487061995?rel=author">
      <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
      Google+
    </a>
  </h1>
</section>



  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - Jerzy Chalupski -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'porcupineprogrammer';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>





  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
